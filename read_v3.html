<!DOCTYPE html>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>
var link_ID = new Array;
var gacode = new Array;
var gacode_str = new String;
$(document).ready(function(){

      // $.get("ts.htm", function(data, status){
      //       var link = data.match(/<a.*?a>/g)
      //       for (var i = 0; i < link.length; i++) {
      //             var select = '<form> \n\
      //              Event_Category : \n\
      //             <input type="text" name="Event_Category"> <br>\n\
      //             Event_Action : \n\
      //             <input type="text" name="Event_Action"> <br>\n\
      //                Event_Label<select name="Event_label" id="event_label" size="4">\n\
      //                  <option>form</option>\n\
      //                  <option>questionnaire</option>\n\
      //                  <option>button</option>\n\
      //                  <option>others</option>\n\
      //                </select>\n\
      //             <input id=' + link_ID[i]+ '2' + ' type="button" value="確認"> <br>\n\
      //              </form>'
      //             $("#"+link_ID[i]).append(select + '<br>')
      //       }
      // }
      $("button").click(function(){
        $.get("ts.htm", function(data, status){
            //alert("Data: " + data + "\nStatus: " + status);
            //偵測連結類型的元素
            var link = data.match(/<a.*?a>/g)
            var button_data = data.match(/<button.*?>/g)
            console.log(link)
            for (var i = 0; i < link.length; i++) {
                  link_ID[i] = link[i].replace(/"/g,"")
                  link_ID[i] = link_ID[i].match(/id=.*? /g)

                  if(link_ID[i] == null)
                  {
                        continue;
                  }
                  if(link_ID[i] == null)
                  {
                        continue;
                  }
                  link_ID[i] = link_ID[i].toString().replace("id=","")
                  link_ID[i] = link_ID[i].toString().replace(" ","")

                  if(link_ID[i] == null)
                  {
                        continue;
                  }
                  str = link[i].toString();
                   var idiv = document.createElement('div')
                   idiv.id = link_ID[i];
                   idiv.className = 'block'
                   document.getElementsByTagName('body')[0].appendChild(idiv);
                   text = "$(\"#" + link_ID[i] + "\").click(function(){<br/> \n\ gtag(\'event\', \'action\', <br/>{ \'event_category\' : \'ec\', <br/>\'event_label\' : \'el\' });" +
                        "<br/>});"
                   //$("#"+link_ID[i]).html(i + ": <br>"+ str + "<br>:"+text +"<br>")
                  var select = '<form> \n\
                      Event_Category : \n\
                     <input type="text" name="Event_Category'+i+'"> <br>\n\
                     Event_Action : \n\
                     <input type="text" name="Event_Action'+i+'"> <br>\n\
                        Event_Label<select name="Event_label'+i+'" id="event_label" size="4">\n\
                          <option>form</option>\n\
                          <option>questionnaire</option>\n\
                          <option>button</option>\n\
                          <option>others</option>\n\
                        </select>\n\
                     <input id=' + link_ID[i]+ '2' + ' type="button" value="確認"> <br>\n\
                      </form>'
                  $("#"+link_ID[i]).append("網頁元素:" + str + "<br><請設定GA事件參數> " + select + '<br><hr>')

           }

           //  for (var i = 0; i < button_data.length; i++) {
           //        var button = new Array;
           //        button[i] = button_data[i].match(/class=".*?"/g)

           //        if(button[i] == null)
           //        {
           //              continue;
           //        }

           //        button[i] = button[i].toString().replace("class=","")
           //        button[i] = button[i].toString().replace('"',"")
           //        button[i] = button[i].toString().replace('"',"")
           //        console.log(button[i])
           //        if(button[i] == null)
           //        {
           //              continue;
           //        }
           //        console.log(button[i])
           //        str = button_data[i].toString();
           //        classname = button[i]
           //        console.log(str)
           //        var idiv2 = document.createElement('div')
           //        idiv2.className = classname
           //        document.getElementsByTagName('body')[0].appendChild(idiv2);
           //        text = "$(\'." + button[i] + "').click(function(){<br/> \n\ gtag(\'event\', \'action\', <br/>{ \'event_category\' : \'ec\', <br/>\'event_label\' : \'el\' });" +
           //              "<br/>});"
           //        classname2 = button[i].toString().replace(' ',".")

           //         classname2 = '.'+ classname2;
           //         //$("'."+button3[i]+"'").html(i+":"+text +"<br><br>")
           //         $(classname2).html(i + ": <br>"+ str + classname +"</button>"+ "<br>:"+text +"<br>")

           // }
            
        });
    });
    $('#send').click(function(){
      var form = new Array;
      form = $("form").serializeArray()
      console.log(form)
      console.log(link_ID)
      for(var i = 0; i < link_ID.length; i++)
      {
            if(link_ID[i] ==null)
            {
                  continue
            }
            for(var j = 0; j < form.length; j++)
            {
                  if(form[j].name == null)
                  {
                        continue
                  }
                  var category = "Event_Category" + i 
                  var action = "Event_Action" + i 
                  var value = "Event_label" + i 
                  if(form[j].name == action)
                  {
                        var Event_Action = form[j].value
                        continue
                  }
                  if(form[j].name == category)
                  {
                        var Event_Category = form[j].value
                        continue
                  }
                  if(form[j].name == value)
                  {
                        var Event_value = form[j].value
                        continue
                  }
            }

            text = "$(\"#" + link_ID[i] + "\").click(function(){<br/> \n\ gtag(\'event\', \'"+  Event_Action + "\', <br/>{ \'event_category\' : \'"+ Event_Category +"\', <br/>\'event_label\' : \'" + Event_value +  "\' });" +
                 "<br/>});"
            console.log(text)
            console.log(link_ID[i])
            $("#"+link_ID[i]).html("<br><hr> GA程式碼<br>"+text +"<br><hr>")
            gacode[i] = text;

           // $("#"+link_ID[i]).html(str + ":<br>" + select + '<br>')
      }
      $("#GACode").append('GA追蹤碼:')

      for(var i = 0; i < gacode.length; i++)
      {
            $("#GACode").append(gacode[i]+ '<br>')
      }

    })
});
console.log(gacode)
</script>
</head>
<body>
<div id="text"></div>
<div id="GACode"></div>
<button >分析網頁資料</button>
<button id='send'>產出GACode</button>
</body>

</html>
