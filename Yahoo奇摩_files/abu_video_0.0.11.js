YUI.add("type_abu_video",function(d,c){var e=d.Object.getValue(YUI,["Env","My","settings","context"]);var b=e.videoplayerUrl;var a=function a(f,g){this.videoPlayer=null;this.videoNode=null;this.containerNode=f;this.swapNode=f.one("."+this.SWAP_CLASS);this.state=this._initState(g);this.uuid=f.getData("uuid");this.guid=null;this.VIDEO_CLASS="js-player-container";this.SWAP_CLASS="js-video-target";this.IS_PLAYABLE_CONDITION={isAutoplayable:true,isInViewport:true,isHidden:false,isEnabled:true,isOnEndScreen:false,isPlayerReady:true};this.IS_DESTROYABLE_CONDITION={isDestroyable:true,isInViewport:false,isPlaying:false};this.vpApi=this._getVpApi();};a.prototype._initState=function(g){var f={isDestroyable:true,isAutoplayable:false,isInViewport:(this.containerNode&&this.containerNode.inViewportRegion())||false,isHidden:false,hasInteracted:false,isEnabled:true,isOnEndScreen:false,isLiveEvent:false,isPlaying:false,isMute:false,isExpanded:false};return this.state=d.merge(f,g||{});};a.prototype._swapVideoNode=function(f){if(!this.swapNode){this.swapNode=this.containerNode.one("."+this.SWAP_CLASS);}if(this.swapNode&&this.swapNode.getDOMNode()&&f&&f.getDOMNode()){this.swapNode.replace(f);}};a.prototype._createVideoNode=function(){this.videoNode=d.Node.create('<div class="'+this.VIDEO_CLASS+' Ratio-16-9"><div class="RatioBox"></div></div>');return this.videoNode;};a.prototype.createVideoPlayerByConfig=function(g){var f;var i;var h;if(!g){return null;}this._swapVideoNode(this._createVideoNode());h=new YAHOO.VideoPlatform.VideoPlayer(g);f=this.containerNode&&this.containerNode.generateID();h&&h.render("#"+f+" .RatioBox");this.videoPlayer=h;this.guid=f;this.attachListeners();return this.videoPlayer;};a.prototype.createVideoPlayerByVideoPlayer=function(f){if(!f){return null;}this.videoPlayer=f;return this.videoPlayer;};a.prototype.getGuid=function(){return this.guid;};a.prototype.getUuid=function(){return this.uuid;};a.prototype.isPlayable=function(){return this._getAbilityFlagOnCondition(this.IS_PLAYABLE_CONDITION);};a.prototype.isDestroyable=function(){return this._getAbilityFlagOnCondition(this.IS_DESTROYABLE_CONDITION);};a.prototype._getAbilityFlagOnCondition=function(i){var f=true;var h=Object.keys(i);var g=this;if(Array.isArray(h)){h.forEach(function(j){var k=i[j];f=f&&(g.state[j]===k);});}return f;};a.prototype._setStateByKey=function(f,g){if(!f||typeof g==="undefined"){return;}if(this.state[f]!==g){this.state[f]=g;this.containerNode.fire("video_state:change",f,g);if(typeof this.IS_PLAYABLE_CONDITION[f]==="undefined"){return;}d.Global.fire("video_state:change",this);}};a.prototype.isPlaying=function(){var f=this.videoPlayer;this.state.isPlaying=f&&f.controls&&f.controls.isPlaying();return this.state.isPlaying;};a.prototype.isMute=function(){var f=this.videoPlayer;this.state.isMute=f&&f.controls&&f.controls.getMute();return this.state.isMute;};a.prototype.isExpanded=function(){return this.state.isExpanded;};a.prototype.isLiveEvent=function(){return this.state.isLiveEvent;};a.prototype.isInViewport=function(){return this.state.isInViewport;};a.prototype.isDestroyed=function(){if(!this.videoPlayer||!this.videoNode||!this.videoNode.getDOMNode()){return true;}return false;};a.prototype.isDOMNodeRemoved=function(){if(!this.containerNode||!this.containerNode.getDOMNode()){return true;}};a.prototype.attachListeners=function(){this.onViewEnter();this.onViewLeave();this.onExpand();this.onUiInteract();this.onPlay();this.onPlayComplete();this.onPause();this.onMuteChange();this.onPlayerReady();this.onPlayerAdPlaybackProgress();},a.prototype.onViewEnter=function(){var f=this;this.containerNode&&this.containerNode.on("viewenter",function(g){f._setStateByKey("isInViewport",true);});};a.prototype.onViewLeave=function(){var f=this;this.containerNode&&this.containerNode.on("viewleave",function(g){f._setStateByKey("isInViewport",false);});};a.prototype.onExpand=function(){var f=this;this.containerNode&&this.containerNode.on("video_expand",function(g){f._setStateByKey("isExpanded",g);});};a.prototype.onUiInteract=function(){var f=this;var g=this.videoPlayer;var h=this._getVpApi();h&&g&&g.on(h.UI_INTERACT,function(i){f._setStateByKey("hasInteracted",true);});};a.prototype.onPlay=function(){var f=this;var g=this.videoPlayer;var h=this._getVpApi();h&&g&&g.on(h.PLAYBACK_START,function(i){f._setStateByKey("isPlaying",true);f._setStateByKey("isOnEndScreen",false);});h&&g&&g.on(h.AD_PLAYBACK_START,function(i){f._setStateByKey("isPlaying",true);f._setStateByKey("isOnEndScreen",false);});h&&g&&g.on(h.PLAYBACK_RESUMED,function(i){f._setStateByKey("isPlaying",true);});};a.prototype.onPause=function(){var f=this;var g=this.videoPlayer;var h=this._getVpApi();h&&g&&g.on(h.PLAYBACK_PAUSE,function(i){f._setStateByKey("isPlaying",false);});};a.prototype.onPlayComplete=function(){var f=this;var g=this.videoPlayer;var h=this._getVpApi();h&&g&&g.on(h.PLAYBACK_COMPLETE,function(i){f._setStateByKey("isPlaying",false);f._setStateByKey("isOnEndScreen",true);});};a.prototype.onMuteChange=function(){var f=this;var g=this.videoPlayer;var h=this._getVpApi();h&&g&&g.on(h.PLAYER_MUTE_CHANGE,function(i){f._setStateByKey("isMute",i);});};a.prototype.onPlayerReady=function(){var f=this;var g=this.videoPlayer;var i=this._getVpApi();var h=YMedia.one("body");if(!h.scrollInfo){h.plug(YMedia.Plugin.ScrollInfo);}i&&g&&g.on(i.PLAYER_READY,function(){var j=h.scrollInfo.isNodeOnscreen(f.containerNode,e.isNodeOnScreenOffset||-85);f._setStateByKey("isPlayerReady",true);f._setStateByKey("isInViewport",j);});};a.prototype.onPlayerAdPlaybackProgress=function(){var f=this;var g=this.videoPlayer;var i=this._getVpApi();var h=YMedia.one("body");if(!h.scrollInfo){h.plug(YMedia.Plugin.ScrollInfo);}i&&g&&g.on(i.AD_PLAYBACK_PROGRESS,function(){var j=h.scrollInfo.isNodeOnscreen(f.containerNode,e.isNodeOnScreenOffset||-85);if(!j){f._setStateByKey("isInViewport",false);}});};a.prototype._getVpApi=function(){if(!this.vpApi){this.vpApi=YAHOO&&YAHOO.VideoPlatform&&YAHOO.VideoPlatform.API_Events;}return this.vpApi;};a.prototype.destroy=function(){try{this.videoPlayer&&this.videoPlayer.destroy();}catch(f){}if(this.swapNode&&this.swapNode.getDOMNode()&&this.videoNode&&this.videoNode.getDOMNode()){this.videoNode.replace(this.swapNode);}if(this.isDOMNodeRemoved()){this.containerNode&&this.containerNode.destroy();}this.videoNode&&this.videoNode.destroy();this.videoplayer=null;this.videoNode=null;};a.prototype.play=function(){var f=this.videoPlayer;this.state.isPlaying=f&&f.controls&&f.controls.isPlaying();if(!this.state.isPlaying){f&&f.controls&&f.controls.play();}};a.prototype.pause=function(){var f=this.videoPlayer;this.state.isPlaying=f&&f.controls&&f.controls.isPlaying();if(this.state.isPlaying){f&&f.controls&&f.controls.pause();}};a.prototype.setMute=function(f){var g=this.videoPlayer;g&&g.controls&&g.controls.setMute(f);};a.prototype.hide=function(){this._setStateByKey("isHidden",true);};a.prototype.show=function(){this._setStateByKey("isHidden",false);};a.prototype.enable=function(){this._setStateByKey("isEnabled",true);};a.prototype.disable=function(){this._setStateByKey("isEnabled",false);};d.Video=a;},"0.0.1",{requires:["af-content","af-event","base","event-custom","type_abu_event","node-core","node-scroll-info"]});/* Copyright (c) 2018, Yahoo! Inc.  All rights reserved. */
