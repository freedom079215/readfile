YUI.add("td-applet-abuads-mainview-tabads",function(t){"use strict";var e={};t.namespace("TD.Applet").AbuadsMainViewTabads=t.Base.create("TDAppletAbuadsMainViewTabads",t.Af.AppletView,[],{initializer:function(t){var e,i={".ads-tabitem":{}},n=t.defaultPosition;this.pointerSupport=window.navigator.pointerEnabled||window.navigator.msPointerEnabled,this.enableTdRemote=t.enableTdRemote,this.rmpLocker=!1,this.tabSwitchEvent=t.mouseoverTabSwitch?"mouseover":"click",this.positions=t.positions||[],this.positionIndex=this.getCurrentPositionIndex(t.defaultPosition),this.container=this.get("container"),this.isECUser=t.isECUser,this.adRefreshDelay=parseInt(t.adRefreshDelay,10)||1e4,this.adRetry=t.enableAdRetry,t.enableAutoAdRefresh&&this.addAutoRefreshEvent(),i[".ads-tabitem"][this.tabSwitchEvent]="switchAd",this.attachEvents(i),this.visited={},t.initFetch&&n?(e=this.container.one("[data-ad-name=my-ads"+n+"]"))&&this.fireDarlaEvent(e)&&(this.visited[n]=!0):n&&(this.visited[n]=!0),this.remoteConfigs=t.remoteConfigs,t.enablePrefetchEcbestbuy&&this.triggerPrefetchEcbestbuy()},getCurrentPositionIndex:function(t){return this.positions&&this.positions.indexOf?this.positions.indexOf(t):-1},triggerPrefetchEcbestbuy:function(){var t=this;setTimeout(function(){t.fetchRemoteApplet("ecbestbuyc")},3e3)},autoChangeTab:function(){var t,e=this.getNextPosition();e&&this.container&&this.container.one&&(t=this.container.one("."+e))&&t.simulate&&t.simulate(this.tabSwitchEvent)},addAutoRefreshEvent:function(){setInterval&&setInterval(this.autoChangeTab.bind(this),this.adRefreshDelay)},getDarlaTarget:function(t){return t.hasClass("ads-tabitem")?t.one("span"):t},getNextPosition:function(){var t;return this.positions&&this._isArray(this.positions)||(t=null),this.positionIndex++,(this.positionIndex>=this.positions.length||this.positionIndex<0)&&(this.positionIndex=0),(t=this.positions[this.positionIndex])||(t=null),t},switchAd:function(t){var e,i,n=this.getDarlaTarget(t.target),s=n&&n.ancestor&&n.ancestor("li"),a=s&&s.ancestor&&s.ancestor("ul"),o=s&&s.get&&s.get("id"),r=a&&a.get&&a.get("id");t.preventDefault(),n&&(this.pointerSupport&&o&&r&&YMedia.Stencil.TabPanel("show","#"+r,"#"+o),e=n.getAttribute("data-tab-key"),i=n.getAttribute("data-ad-event"),this.positionIndex=this.getCurrentPositionIndex(e),this.visited[e]||(i?this.adRetry?this.retryFiringDarlaEvent(i,e):this.visited[e]=this.fireDarlaEvent(i):this.remoteConfigs[e]&&this.fetchRemoteApplet(e,n)))},retryFiringDarlaEvent:function(t,i){var n,s,a,o;e[i]||(e[i]=!0,n=0,s=this,o=function(){n++,DARLA.inProgress()||(clearInterval(a),s.visited[i]=s.fireDarlaEvent(t),e[i]=!1),n>100&&(clearInterval(a),e[i]=!1)},DARLA&&DARLA.inProgress&&DARLA.event&&(DARLA.inProgress()?a=setInterval(o,600):this.visited[i]=this.fireDarlaEvent(t)))},fireDarlaEvent:function(t){var e={};return!(!t||DARLA.inProgress())&&("undefined"!=typeof this.isECUser&&(e={sa:{EC_user:this.isECUser}}),DARLA.event(t,e),!0)},fetchRemoteApplet:function(t,e){if(this.enableTdRemote&&!this.rmpLocker&&!this.visited[t]){this.rmpLocker=!0;var i=this,n=e?e.getAttribute("data-tabpanel-target"):"#ads-"+t;this.initRemoteApplet({type:this.remoteConfigs[t].type,params:this.remoteConfigs[t].params,placementNode:n,callback:function(e){i.defaultRemoteAppletCallback(e),e||(i.visited[t]=!0),i.rmpLocker=!1}})}},initRemoteApplet:function(t){return!!(t&&t.type&&t.placementNode)&&(this.fireEvent("remoteapplet",{type:t.type,method:"post",params:t.params,placement:{node:t.placementNode},callback:t.callback?t.callback:this.defaultRemoteAppletCallback}),!0)},defaultRemoteAppletCallback:function(t){t&&console&&console.log("abuads: failed to fetch remote applet")},_debounce:function(t,e){var i;return function(){var n=this,s=arguments,a=function(){i=null,t.apply(n,s)};clearTimeout(i),i=setTimeout(a,e)}},_isArray:function(t){return Array.isArray?Array.isArray(t):"[object Array]"===Object.prototype.toString.call(t)},isInViewport:function(t){var e=t.getBoundingClientRect();return e.top>=0&&e.left>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&e.right<=(window.innerWidth||document.documentElement.clientWidth)}})},"@VERSION@",{requires:["af-applet-view","node-event-simulate"]});